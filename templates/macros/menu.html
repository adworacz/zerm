{% macro menu() %}
    <nav class="menu">
        {% if config.extra.js_menu %}
            {{ menu::js_menu() }}
        {% else %}
            {{ menu::nojs_menu() }}
        {% endif %}
    </nav>
{% endmacro menu %}

{% macro nojs_menu() %}
    {%- if config.extra.main_menu %}
        {%- set menu_items = config.extra.main_menu -%}
        <ul class="menu__inner">
        {%- for item in menu_items %}
            {%- set abs_item_url = get_url(path=item.url) -%}
            {%- set is_current = current_url == abs_item_url
                                 or current_url is starting_with(abs_item_url)
            -%}
            {%- set is_base = abs_item_url == config.base_url
                              or abs_item_url == config.base_url ~ "/"
            -%}

            {%- if is_base %}
                {%- set_global base_item = item -%}
            {% endif -%}

            {%- if is_current and not is_base %}
                {%- set_global current_item = item -%}
            {% endif -%}
        {% endfor -%}

        {%- if not current_item and base_item %}
            {# Did not match any menu URLs -- assume it's a blog post #}
            {%- set current_item = base_item -%}
        {% endif -%}

        {%- for item in menu_items %}
            <li {%- if current_item and current_item == item %} class="active" {%- endif %}>
                <a href="{{ get_url(path=item.url) }}" {% if item.newtab %}target="_blank" rel="noopener noreferrer"{% endif %}>{{ item.name }}</a>
            </li>
        {% endfor -%}
        </ul>
    {% endif -%}
{% endmacro %}

{% macro js_menu() %}
        <ul class="menu__inner menu__inner--desktop">
            {# 
            I am almost certain this check isn't necessary, that it will always
            return true, but the only alternative I can think of is the case where
            this config value simply doesn't exist (null)? IDK, just copying from
            original implementation for now.
            #}
            {% if config.extra.show_menu_items is defined -%}
                {% for menu_item in config.extra.main_menu | slice(end=config.extra.show_menu_items) -%}
                    {# 
                    Original theme has sub-children checks on main-menu, not worrying about that here.
                    #}
                    <li>
                        <a href="{{ get_url(path=menu_item.url) }}">{{ menu_item.name }}</a>
                    </li>
                {% endfor -%}

                {%- set main_len = config.extra.main_menu | length -%}
                {%- set show_len = config.extra.show_menu_items -%}

                {%- if main_len > show_len -%}
                    <ul class="menu__sub-inner">
                        <li class="menu__sub-inner-more-trigger">{{ config.extra.menu_more }} â–¾</li>
                        <ul class="menu__sub-inner-more hidden">
                            {{ menu::items(menu=config.extra.main_menu | slice(start=config.extra.show_menu_items)) }}
                        </ul>
                    </ul>
                {%- endif -%}
                {# Continues the original if-check at top of file for show_menu_items #}
            {% else -%}
                {{ menu::items(menu=config.extra.main_menu) }}
            {%- endif -%}
        </ul>

        <ul class="menu__inner menu__inner--mobile">
            {{ menu::items(menu=config.extra.main_menu) }}
        </ul>
{% endmacro %}

{% macro items(menu) %}
    {%- for menu_item in menu -%}
        {# skipping sub-child check #}
        <li>
            <a href="{{ get_url(path=menu_item.url) }}">{{ menu_item.name }}</a>
        </li>
    {%- endfor-%}
{% endmacro items %}
